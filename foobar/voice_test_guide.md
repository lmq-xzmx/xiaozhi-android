# 🎤 语音功能测试指导

## 📋 问题诊断结果

### ✅ **已修复**：
- **录音权限**：已成功授予 `android.permission.RECORD_AUDIO`
- **WebSocket连接**：正常建立并保持连接
- **应用状态**：显示"✅ 就绪"而不是"Idle"
- **操作按钮**：提供"开始监听"按钮

### ⚠️ **待验证**：
- **语音识别**：需要测试麦克风和语音反馈
- **服务器响应**：需要确认STT功能正常工作

## 🧪 测试步骤

### 步骤1：确认应用状态
1. 打开应用
2. 确认显示：`✅ 就绪`
3. 确认有"开始监听"按钮

### 步骤2：开始语音测试
1. **点击"开始监听"按钮**
2. **观察状态变为**：`🎤 监听中`
3. **清晰地说话**：
   - "你好，小智"
   - "今天天气怎么样"
   - "介绍一下你自己"

### 步骤3：观察反馈
**正常情况应该看到**：
- 状态变为：`🔊 回复中`
- 聊天区域显示用户说的话
- 接着显示AI的回复
- 状态返回：`✅ 就绪`

### 步骤4：如果没有反馈
1. **检查麦克风**：确认设备麦克风工作正常
2. **重试操作**：点击"停止监听"，再点击"开始监听"
3. **说话更清晰**：靠近麦克风，清晰发音
4. **等待时间**：给服务器3-5秒处理时间

## 🔍 实时监控

### 监控命令
```bash
adb -s SOZ95PIFVS5H6PIZ logcat | grep -E "stt|STT|listen|speak|audio|WS.*Received"
```

### 期望的日志输出
```
ChatViewModel: Device state set to LISTENING        # 开始监听
AudioRecorder: Starting audio recording             # 音频录制启动
AudioRecorder: Audio frames processed: 50           # 音频数据处理
WS: Sending audio frame #1: 120 bytes              # 发送音频数据
WS: Received text message: {"type":"stt",...}      # 收到语音识别结果
ChatViewModel: >> 你好小智                           # 显示用户语音
WS: Received text message: {"type":"tts",...}      # 收到TTS回复
ChatViewModel: << 你好，我是小智...                  # 显示AI回复
```

## ⚠️ 故障排除

### 如果状态不变为"监听中"
**可能原因**：
- 音频权限问题
- AudioRecorder初始化失败
- WebSocket连接断开

**解决方案**：
1. 重新启动应用
2. 检查权限设置
3. 确认网络连接

### 如果监听中但无反馈
**可能原因**：
- 麦克风硬件问题
- 音频编码失败
- 服务器STT服务异常

**解决方案**：
1. 测试其他录音应用确认麦克风工作
2. 检查服务器状态：`curl http://47.122.144.73:8000/xiaozhi/v1/`
3. 查看错误日志

### 如果收到识别结果但无AI回复
**可能原因**：
- 服务器LLM服务异常
- TTS服务问题
- 网络延迟

**解决方案**：
1. 等待更长时间（10-15秒）
2. 检查服务器负载
3. 重试不同的问题

## 🎯 预期结果

**成功的语音交互应该是这样的**：

1. 👆 点击"开始监听" → `🎤 监听中`
2. 🗣️ 说话："你好小智"
3. 👀 看到用户消息："你好小智"
4. ⚡ 状态变为：`🔊 回复中`
5. 🤖 看到AI回复："你好，我是小智..."
6. ✅ 状态返回：`✅ 就绪`

**整个过程大约需要3-8秒完成。**

## 📞 如果仍有问题

1. **重新启动应用**
2. **检查网络连接**
3. **确认服务器状态**
4. **查看详细日志**：运行监控命令
5. **联系技术支持**：提供日志信息

---

**记住：现在录音权限已经授予，语音功能应该正常工作了！** 🎉 