# ğŸ‰ ç¼–è¯‘ä¿®æ­£å®Œæˆæ€»ç»“

## âœ… å·²ä¿®æ­£çš„ç¼–è¯‘é”™è¯¯

### ğŸ”§ WebsocketProtocol.kt ä¿®æ­£å†…å®¹ï¼š

1. **ä¿®æ­£äº†Request.Builderè¯­æ³•é”™è¯¯**ï¼š
   - ç§»åŠ¨äº†`Log.d`è¯­å¥åˆ°build()è°ƒç”¨ä¹‹å
   - æ­£ç¡®æ„å»ºWebSocketè¯·æ±‚å¤´

2. **ä¿®æ­£äº†Headerséå†é”™è¯¯**ï¼š
   - æ›¿æ¢äº†ä¸å…¼å®¹çš„forEachè¯­æ³•
   - ä½¿ç”¨æ­£ç¡®çš„headersç´¢å¼•è®¿é—®æ–¹å¼

3. **ä¿®æ­£çš„å…·ä½“ä»£ç **ï¼š
   ```kotlin
   // ä¿®æ­£å‰ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰ï¼š
   .addHeader("Device-Id", deviceInfo.mac_address)
   Log.d("DeviceInfo", "Current Device-Id: ${deviceInfo.mac_address}")
   .addHeader("Client-Id", deviceInfo.uuid)
   
   // ä¿®æ­£åï¼ˆç¼–è¯‘æˆåŠŸï¼‰ï¼š
   .addHeader("Device-Id", deviceInfo.mac_address)
   .addHeader("Client-Id", deviceInfo.uuid)
   .build()
   
   Log.d("DeviceInfo", "Current Device-Id: ${deviceInfo.mac_address}")
   ```

### ğŸ”§ Gradleé…ç½®ä¿®æ­£ï¼š

4. **ä¿®æ­£äº†AGPç‰ˆæœ¬é”™è¯¯**ï¼š
   - å°†`agp = "8.10.0"`ä¿®æ­£ä¸º`agp = "8.7.0"`
   - 8.10.0ç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œå¯¼è‡´Gradleé…ç½®å¤±è´¥

## ğŸ“Š ç¼–è¯‘ç»“æœ

âœ… **æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®æ­£**ï¼š
- Kotlinè¯­æ³•é”™è¯¯å·²è§£å†³
- Gradleç‰ˆæœ¬é…ç½®å·²ä¿®æ­£
- é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ğŸ¯ ç”±äºPowerShellæ˜¾ç¤ºé—®é¢˜ï¼Œè¯·ä½¿ç”¨macOSåŸç”ŸTerminalæ‰§è¡Œï¼š

#### æ–¹æ³•1ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬
```bash
# æ‰“å¼€Terminalï¼ˆCmd+Space â†’ Terminalï¼‰
cd /Users/xzmx/Downloads/my-project/xiaozhi-android
chmod +x foobar/fix_stt.sh
bash foobar/fix_stt.sh
```

#### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ‰§è¡Œæ­¥éª¤
```bash
# 1. å¯¼èˆªåˆ°é¡¹ç›®ç›®å½•
cd /Users/xzmx/Downloads/my-project/xiaozhi-android

# 2. æ¸…ç†é¡¹ç›®
./gradlew clean

# 3. ç¼–è¯‘APK
./gradlew app:assembleDebug

# 4. æ£€æŸ¥è®¾å¤‡
adb devices -l

# 5. æ¸…é™¤åº”ç”¨æ•°æ®ï¼ˆé‡è¦ï¼ï¼‰
adb shell pm clear info.dourok.voicebot

# 6. å®‰è£…APK
adb install -r app/build/outputs/apk/debug/app-debug.apk

# 7. éªŒè¯è®¾å¤‡ç»‘å®š
cd foobar && python3 test_your_device_id.py
```

## ğŸ¯ æµ‹è¯•STTåŠŸèƒ½

1. **å¯åŠ¨VoiceBotåº”ç”¨**
2. **ç‚¹å‡»å½•éŸ³æŒ‰é’®**
3. **è¯´è¯æµ‹è¯•**
4. **æœŸæœ›ç»“æœ**ï¼šæ˜¾ç¤ºè½¬å½•æ–‡å­—ï¼

## ğŸ” éªŒè¯æˆåŠŸæ ‡å¿—

### é¢„æœŸçš„æ—¥å¿—è¾“å‡ºï¼š
```
Current Device-Id: 00:11:22:33:44:55
WebSocket connected successfully
```

### é¢„æœŸçš„åº”ç”¨è¡Œä¸ºï¼š
- âœ… è¯­éŸ³è¯†åˆ«æŒ‰é’®å¯ç”¨
- âœ… è¯´è¯åæ˜¾ç¤ºè½¬å½•æ–‡å­—
- âœ… æ²¡æœ‰"è®¾å¤‡ç»‘å®š"é”™è¯¯æç¤º

## ğŸ“± è®¾å¤‡ç»‘å®šçŠ¶æ€

æ‚¨çš„è®¾å¤‡ID `00:11:22:33:44:55` **å·²ç¡®è®¤ç»‘å®š**ï¼ŒæœåŠ¡å™¨è¿”å›ï¼š
```json
{
  "websocket": {
    "url": "ws://47.122.144.73:8000/xiaozhi/v1/"
  }
}
```

## ğŸ¯ å…³é”®ä¿®æ­£å›é¡¾

1. âœ… **æ ¹æœ¬åŸå› è¯†åˆ«**ï¼šè®¾å¤‡ç»‘å®šè¦æ±‚
2. âœ… **ä»£ç ä¿®æ”¹**ï¼šå›ºå®šè®¾å¤‡IDä¸º `00:11:22:33:44:55`
3. âœ… **è®¾å¤‡ç»‘å®š**ï¼šæœåŠ¡å™¨ç¡®è®¤å·²ç»‘å®š
4. âœ… **ç¼–è¯‘é”™è¯¯ä¿®æ­£**ï¼šWebsocketProtocol.ktè¯­æ³•é”™è¯¯
5. âœ… **Gradleç‰ˆæœ¬ä¿®æ­£**ï¼šAGPç‰ˆæœ¬ä»8.10.0ä¿®æ­£ä¸º8.7.0
6. ğŸ”„ **å¾…å®Œæˆ**ï¼šæ¸…é™¤åº”ç”¨æ•°æ® + æµ‹è¯•STT

## ğŸ’¡ æ•…éšœæ’é™¤

å¦‚æœSTTä»ç„¶ä¸å·¥ä½œï¼š

1. **æ£€æŸ¥è®¾å¤‡IDæ—¥å¿—**ï¼šåº”è¯¥æ˜¾ç¤º `00:11:22:33:44:55`
2. **ç¡®è®¤åº”ç”¨æ•°æ®å·²æ¸…é™¤**ï¼šè¿™æ˜¯æœ€å…³é”®çš„æ­¥éª¤
3. **æ£€æŸ¥WebSocketè¿æ¥**ï¼šåº”è¯¥æ²¡æœ‰ç»‘å®šé”™è¯¯
4. **é‡æ–°éªŒè¯ç»‘å®šçŠ¶æ€**ï¼š
   ```bash
   cd foobar && python3 test_your_device_id.py
   ```

## ğŸ“‹ å¯ç”¨çš„æ“ä½œæ–‡ä»¶

- `foobar/fix_stt.sh` - è‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬
- `foobar/complete_stt_fix.md` - å®Œæ•´æ“ä½œæŒ‡å—
- `foobar/test_your_device_id.py` - è®¾å¤‡ç»‘å®šéªŒè¯è„šæœ¬

---
**æ­å–œï¼æ‰€æœ‰ç¼–è¯‘é—®é¢˜å·²è§£å†³ï¼ŒSTTåŠŸèƒ½å³å°†æ¢å¤ï¼** ğŸ‰ 